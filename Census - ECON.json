{"paragraphs":[{"text":"%md\n\n## Data Science in Apache Spark\n### Census - Econ Workbook\n#### Report Building\n\n**Level**: Moderate\n**Language**: Scala\n**Requirements**: \n- [HDP 2.6.X]\n- Spark 2.x\n\n**Author**: Ian Brooks\n**Follow** [LinkedIn - Ian Brooks PhD] (https://www.linkedin.com/in/ianrbrooksphd/)\n\n![Census](https://yt3.ggpht.com/a-/AN66SAwtUzDFUsvm7MJszIS3ccgglaFGrw1_Ye16ew=s900-mo-c-c0xffffffff-rj-k-no \"Census\")\n\n## Pre-Run Instructions\n\n**Source File:** \nUpload the source data file  [CFS 2012 csv] (https://www.census.gov/econ/cfs/pums.html) to HDFS in the /tmp directory \n\n**Helper Files File:** \nUpload the helper files  [] () to HDFS in the /tmp directory \n\n## File Description\n\nThe PUM file includes 20 variables for all usable shipment records collected by the CFS – a total of 4,547,661 shipments from approximately 60,000 responding establishments.  The information included on each shipment record is:\n*\tShipment Origin\n    *\tState \n    *\tMetropolitan Area\n*\tShipment Destination (in US)\n    *\tState\n    *\tMetropolitan Area\n*\tNAICS industry classification of the shipper\n*\tQuarter in 2012 in which the shipment was made\n*\tType of commodity \n*\tMode of transportation\n*\tThe value of the shipment (dollars)\n*\tThe weight of the shipment (pounds)\n*\tThe great circle distance between the shipment origin and US destination (in miles)\n*\tThe routed distance between the shipment origin and US destination (in miles) \n*\tWhether or not the shipment required temperature control during transportation\n*\tWhether or not the shipment was an export\n*\tIf an export, the final export destination country\n*\tHazardous material code\n*\tShipment tabulation weighting factor \n\n##Column Descriptions \n\n* SHIPMT_ID   Shipment identifier\t\n* ORIG_STATE\tFIPS state code of shipment origin\t\n* ORIG_MA\tMetro area of shipment origin\t\n* ORIG_CFS_AREA\tCFS Area of shipment origin\tConcatenation of ORIG_STATE and ORIG_MA (ex: 24-12580)\n* DEST_STATE\tFIPS state code of shipment destination\t01-56\n* DEST_MA\tMetro area of shipment destination\tSee Note (1)\n* DEST_CFS_AREA\tCFS Area of shipment destination\tConcatenation of DEST_STATE and DEST_MA (ex: 01-142)\n* NAICS\tIndustry classification of shipper\tSee Note (2)\n* QUARTER\tQuarter of 2012 in which the shipment occurred\t1, 2, 3, 4\n* SCTG\t2-digit SCTG commodity code of the shipment\tSee Note (3)\n* MODE\tMode of transportation of the shipment\tSee Note (4)\n* SHIPMT_VALUE\tValue of the shipment in dollars\t0 - 999,999,999\n* SHIPMT_WGHT\tWeight of the shipment in pounds\t0 - 999,999,999\n* SHIPMT_DIST_GC\tGreat circle distance between ship-ment origin and destination (in miles)\t0 - 99,999\n* SHIPMT_DIST_ROUTED\tRouted distance between shipment origin and destination (in miles)\t0 - 99,999\n* TEMP_CNTL_YN\tTemperature controlled shipment - Yes or No\tY, N\n* EXPORT_YN\tExport shipment - Yes or No\tY, N\n* EXPORT_CNTRY\tExport final destination\t\n\t* C = Canada\n\t* M = Mexico\n\t* O = Other country\n\t* N = Not an export\n* HAZMAT\tHazardous material (HAZMAT) code\t\n\t* P = Class 3.0 Hazmat (flammable liquids)\n\t* H = Other Hazmat\n\t* N = Not Hazmat\n* WGT_FACTOR\tShipment tabulation weighting factor.  (This factor is also an estimate of the total number of shipments represent-ted by the PUM file shipment.)\t0 – 975,000.0","user":"admin","dateUpdated":"2018-11-30T09:04:45-0800","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712771_-903461614","id":"20180418-065424_1012699794","dateCreated":"2018-11-01T13:55:12-0700","dateStarted":"2018-11-30T09:04:45-0800","dateFinished":"2018-11-30T09:04:45-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:9058"},{"title":"Load Dependency Library (Before Spark Context)","text":"%spark2.dep \n\nz.load(\"com.databricks:spark-csv_2.11:1.5.0\")\n","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"scala","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/scala","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712773_-905770107","id":"20180418-065552_1027381310","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9059"},{"title":"Download Files","text":"%sh\n\n# Download data from Github\nwget https://raw.githubusercontent.com/BrooksIan/CensusEcon/master/CFS_2012_table_CFSArea.csv -O /tmp/CFS_2012_table_CFSArea.csv\nwget https://raw.githubusercontent.com/BrooksIan/CensusEcon/master/CFS_2012_table_ModeofTrans.csv -O /tmp/CFS_2012_table_ModeofTrans.csv\nwget https://raw.githubusercontent.com/BrooksIan/CensusEcon/master/CFS_2012_table_NAICS.csv -O /tmp/CFS_2012_table_NAICS.csv\nwget https://raw.githubusercontent.com/BrooksIan/CensusEcon/master/CFS_2012_table_SCTG.csv -O /tmp/CFS_2012_table_SCTG.csv\nwget https://raw.githubusercontent.com/BrooksIan/CensusEcon/master/CFS_2012_table_StateCodes.csv -O /tmp/CFS_2012_table_StateCodes.csv\n\n# Download data from Census\nwget https://www2.census.gov/programs-surveys/cfs/datasets/2012/2012-pums-files/cfs-2012-pumf-csv.zip -O /tmp/cfs-2012-pumf-csv.zip -o /dev/null\n\n# Unzip Census Data\ncd /tmp/\nunzip cfs-2012-pumf-csv.zip\n\n\n","user":"admin","dateUpdated":"2018-12-03T12:03:00-0800","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false},"editorMode":"ace/mode/sh","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1543595497847_-1556817369","id":"20181130-083137_1715571317","dateCreated":"2018-11-30T08:31:37-0800","dateStarted":"2018-12-03T12:03:00-0800","dateFinished":"2018-12-03T12:04:54-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9060"},{"title":"Upload Files to HDFS","text":"%sh\n\n# Make HDFS Directory and Load CSV files into HDFS\nhadoop fs -mkdir /tmp/\nhadoop fs -put /tmp/CFS_2012_table_CFSArea.csv /tmp/CFS_2012_table_CFSArea.csv\nhadoop fs -put /tmp/CFS_2012_table_ModeofTrans.csv /tmp/CFS_2012_table_ModeofTrans.csv\nhadoop fs -put /tmp/CFS_2012_table_NAICS.csv /tmp/CFS_2012_table_NAICS.csv\nhadoop fs -put /tmp/CFS_2012_table_SCTG.csv /tmp/CFS_2012_table_SCTG.csv\nhadoop fs -put /tmp/CFS_2012_table_StateCodes.csv /tmp/CFS_2012_table_StateCodes.csv\nhadoop fs -put /tmp/cfs_2012_pumf_csv.txt /tmp/cfs_2012_pumf_csv.txt\n\n# List files in HDFS\nhadoop fs -ls /tmp/CFS_2012*\nhadoop fs -ls /tmp/cfs*.txt","user":"admin","dateUpdated":"2018-12-03T12:05:06-0800","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false},"editorMode":"ace/mode/sh","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1543867114344_-430792899","id":"20181203-115834_1842046649","dateCreated":"2018-12-03T11:58:34-0800","dateStarted":"2018-12-03T12:05:06-0800","dateFinished":"2018-12-03T12:05:34-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9061"},{"title":"Initialize Spark Session ","text":"%spark2\n\nimport org.apache.spark.sql.SparkSession\nval spark: SparkSession = SparkSession.builder\n  .appName(\"CensusMash\")  // optional and will be autogenerated if not specified\n  .master(\"local[*]\")               // avoid hardcoding the deployment environment\n  .enableHiveSupport()              // self-explanatory, isn't it?\n  .config(\"spark.sql.warehouse.dir\", \"target/spark-warehouse\")\n  .getOrCreate\n\nspark.version\n","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"scala","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/scala","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712774_-904615861","id":"20180418-065656_1590338863","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9062"},{"title":"Load Data Files","text":"%spark2\n\nimport org.apache.spark.sql.types._\nimport org.apache.spark.sql.DataFrame\nimport scala.collection.mutable.ListBuffer\n\n\n//Note the location of the Data File - hdfs://HostWithNameNode:8020/tmp/MushroomDatabase.csv\n//Create a data frame from CSV File \nval df_WholeSetRaw = sqlContext.read.format(\"com.databricks.spark.csv\").option(\"header\", \"true\").option(\"inferSchema\", \"true\").load(\"/tmp/cfs_2012_pumf.csv\")\n\n//Create Table from DataFrame\ndf_WholeSetRaw.createOrReplaceTempView(\"CensusECON\")\n\n//Display resulting Infered schema \ndf_WholeSetRaw.printSchema()\n\n\n//Load Helper Files and Build Tables\n\n//CFS Area\nval df_Table_CFSArea = sqlContext.read.format(\"com.databricks.spark.csv\").option(\"header\", \"true\").option(\"inferSchema\", \"true\").load(\"/tmp/CFS_2012_table_CFSArea.csv\")\n\n//Mode of Transportation \nval df_Table_ModeofTrans = sqlContext.read.format(\"com.databricks.spark.csv\").option(\"header\", \"true\").option(\"inferSchema\", \"true\").load(\"/tmp/CFS_2012_table_ModeofTrans.csv\")\n\n//NAICS - North American Industry Classificatio System Codes\nval df_Table_NAICS = sqlContext.read.format(\"com.databricks.spark.csv\").option(\"header\", \"true\").option(\"inferSchema\", \"true\").load(\"/tmp/CFS_2012_table_NAICS.csv\")\n\n//SCTG - Standard Classification of Transported Goods Codes\nval df_Table_SCTG = sqlContext.read.format(\"com.databricks.spark.csv\").option(\"header\", \"true\").option(\"inferSchema\", \"true\").load(\"/tmp/CFS_2012_table_SCTG.csv\")\n\n//State Codes\nval df_Table_StateCodes = sqlContext.read.format(\"com.databricks.spark.csv\").option(\"header\", \"true\").option(\"inferSchema\", \"true\").load(\"/tmp/CFS_2012_table_StateCodes.csv\")\n\n//Create Table from DataFrames\ndf_Table_CFSArea.createOrReplaceTempView(\"CensusECON_CFSArea\")\ndf_Table_ModeofTrans.createOrReplaceTempView(\"CensusECON_MoT\")\ndf_Table_NAICS.createOrReplaceTempView(\"CensusECON_NAICS\")\ndf_Table_SCTG.createOrReplaceTempView(\"CensusECON_SCTG\")\ndf_Table_StateCodes.createOrReplaceTempView(\"CensusECON_StateCodes\")\n","user":"admin","dateUpdated":"2018-11-30T08:31:31-0800","config":{"editorSetting":{"language":"scala"},"colWidth":12,"editorMode":"ace/mode/scala","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712774_-904615861","id":"20180418-065741_993102806","dateCreated":"2018-11-01T13:55:12-0700","dateStarted":"2018-11-30T08:31:31-0800","dateFinished":"2018-11-30T08:31:52-0800","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9063"},{"title":"Merge Datasets","text":"%sql\n\nselect A.shipmt_id, A.orig_state, H.state as OrigState, A.orig_ma, A.orig_cfs_area, B.description as OrgCSFArea, A.dest_state, H.state as DestState, A.dest_ma, A.dest_cfs_area,  C.description as DestCSFArea, A.naics, D.description as NAICSDesc, A.quarter, A.sctg, E.description as SCTGDesc, A.mode, F.description as ModeDesc, A.shipmt_value, A.shipmt_wght, A.shipmt_dist_gc, A.shipmt_dist_routed, A.temp_cntl_yn, A.export_yn, A.export_cntry, A.hazmat, A.wgt_factor, A.quarter \n\nfrom censusecon as A, censusecon_cfsarea as B, censusecon_cfsarea as C, censusecon_naics as D, censusecon_sctg as E, censusecon_mot as F, censusecon_statecodes as G, censusecon_statecodes as H\n\nwhere A.orig_cfs_area = B.CFSArea and  A.dest_cfs_area = C.CFSArea and A.naics = D.naics and A.sctg = E.sctg and A.mode = F.modecode and A.orig_state = G.code and A.dest_state = H.code\n\nlimit 10","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sql","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712775_-905000610","id":"20180418-080019_625626529","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9064"},{"text":"%spark2\n\nval df_joinedSet = df_WholeSetRaw.join(df_Table_CFSArea, df_WholeSetRaw.col(\"orig_cfs_area\") === df_Table_CFSArea.col(\"CFSArea\"))\n\ndf_joinedSet.printSchema()\n\ndf_joinedSet.take(1)\n\n","dateUpdated":"2018-11-01T13:55:12-0700","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712775_-905000610","id":"20180418-082239_583012589","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9065"},{"text":"%sql \n\nshow tables\n","dateUpdated":"2018-11-01T13:55:12-0700","config":{"colWidth":12,"editorMode":"ace/mode/sql","results":{},"enabled":true,"editorSetting":{"language":"sql","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712776_-906924354","id":"20180418-074653_394408962","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9066"},{"title":"Table B1 - Shipments by Mode of Transportation","text":"%sql\n\nselect mode, count(shipmt_id) as count, format_number( sum(shipmt_value*wgt_factor), 0) as TotalValue, format_number( sum( wgt_factor*(shipmt_wght/2000)), 0) as TotalTonnage, format_number( (sum( wgt_factor * shipmt_dist_routed)) / sum(wgt_factor), 0) as AvgerageMilesPerShip\n\nfrom CensusEcon group by mode order by mode","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql"},"colWidth":12,"editorMode":"ace/mode/sql","title":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712776_-906924354","id":"20180418-071351_1258043688","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9067"},{"title":"Table B1 - Transportation Mode Count","text":"%sql\n\nselect F.description as ModeDesc, count(A.shipmt_id) as count, format_number( sum(A.shipmt_value*A.wgt_factor), 0) as TotalValue, format_number( sum( A.wgt_factor*(A.shipmt_wght/2000)), 0) as TotalTonnage, format_number( (sum( A.wgt_factor * A.shipmt_dist_routed)) / sum(A.wgt_factor), 0) as AvgerageMilesPerShip\n\nfrom CensusEcon as A, censusecon_mot as F\nwhere  A.mode = F.modecode\ngroup by  F.description \norder by F.description\n\n","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql"},"colWidth":6,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"results":{"0":{"graph":{"mode":"pieChart","height":494,"optionOpen":false,"setting":{"pieChart":{}},"commonSetting":{},"keys":[{"name":"ModeDesc","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"count","index":1,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712777_-907309103","id":"20180418-133848_27481711","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9068"},{"title":"Table B1 - Transportation Mode by Tonnage","text":"%sql\n\nselect F.description as ModeDesc, format_number( sum(A.shipmt_value*A.wgt_factor), 0) as TotalValue,  sum( A.wgt_factor*(A.shipmt_wght/2000)) as TotalTonnage, format_number( (sum( A.wgt_factor * A.shipmt_dist_routed)) / sum(A.wgt_factor), 0) as AvgerageMilesPerShip\n\nfrom CensusEcon as A, censusecon_mot as F\nwhere  A.mode = F.modecode\ngroup by  F.description \norder by F.description\n\n","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql"},"colWidth":6,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"results":{"0":{"graph":{"mode":"pieChart","height":524,"optionOpen":false,"setting":{"pieChart":{},"multiBarChart":{}},"commonSetting":{},"keys":[{"name":"ModeDesc","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"TotalTonnage","index":2,"aggr":"min"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712778_-906154856","id":"20180418-135130_1259378743","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9069"},{"title":"Table B1 - Average Miles Per Shipment by Mode of Transportation","text":"%sql\n\nselect F.description as ModeDesc, count(A.shipmt_id) as count, format_number( sum(A.shipmt_value*A.wgt_factor), 0) as TotalValue, format_number( sum( A.wgt_factor*(A.shipmt_wght/2000)), 0) as TotalTonnage, format_number( (sum( A.wgt_factor * A.shipmt_dist_routed)) / sum(A.wgt_factor), 0) as AvgerageMilesPerShip\n\nfrom CensusEcon as A, censusecon_mot as F\nwhere  A.mode = F.modecode\ngroup by  F.description \norder by F.description\n\n","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql"},"colWidth":6,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"setting":{"pieChart":{},"stackedAreaChart":{},"multiBarChart":{"stacked":false}},"commonSetting":{},"keys":[{"name":"ModeDesc","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"AvgerageMilesPerShip","index":4,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712779_-906539605","id":"20180418-134816_904016102","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9070"},{"title":"Table B1 - Transportation Mode by Shipment Value","text":"%sql\n\nselect F.description as ModeDesc, sum(A.shipmt_value*A.wgt_factor) as TotalValue,  sum( A.wgt_factor*(A.shipmt_wght/2000)) as TotalTonnage, format_number( (sum( A.wgt_factor * A.shipmt_dist_routed)) / sum(A.wgt_factor), 0) as AvgerageMilesPerShip\n\nfrom CensusEcon as A, censusecon_mot as F\nwhere  A.mode = F.modecode\ngroup by  F.description \norder by F.description\n\n","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql"},"colWidth":6,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"results":{"0":{"graph":{"mode":"pieChart","height":300,"optionOpen":false,"setting":{"pieChart":{},"multiBarChart":{}},"commonSetting":{},"keys":[{"name":"ModeDesc","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"TotalValue","index":1,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712779_-906539605","id":"20180418-135657_1454337143","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9071"},{"title":"Table B2 - Shipments by Classification of Goods","text":"%sql\n\nselect sctg, count(shipmt_id) as count, format_number( sum(shipmt_value*wgt_factor), 0) as TotalValue, format_number(sum( wgt_factor*(shipmt_wght/2000)),0) as TotalTonnage, format_number((sum( wgt_factor * shipmt_dist_routed)) / sum(wgt_factor),0) as AvgerageMilesPerShip \n\nfrom CensusEcon as A\ngroup by sctg \norder by sctg","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql"},"colWidth":12,"editorMode":"ace/mode/sql","title":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":true},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712780_-908463350","id":"20180418-071507_1942843547","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9072"},{"title":"Table B2 - Shipments by Classification of Goods by Count","text":"%sql\n\nselect E.description as SCTGDesc, count(A.shipmt_id) as count, sum(A.shipmt_value*A.wgt_factor) as TotalValue, sum( A.wgt_factor*(A.shipmt_wght/2000)) as TotalTonnage, (sum( A.wgt_factor * A.shipmt_dist_routed)) / sum(A.wgt_factor) as AvgerageMilesPerShip \n\nfrom CensusEcon as A, censusecon_sctg as E\nwhere A.sctg = E.sctg\ngroup by E.description \norder by count","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql"},"colWidth":6,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"results":{"0":{"graph":{"mode":"pieChart","height":916,"optionOpen":false},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712780_-908463350","id":"20180418-135857_867838404","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9073"},{"title":"Table B2 - Shipments by Classification of Goods by Value","text":"%sql\n\nselect E.description as SCTGDesc, count(A.shipmt_id) as count, sum(A.shipmt_value*A.wgt_factor) as TotalValue, sum( A.wgt_factor*(A.shipmt_wght/2000)) as TotalTonnage, (sum( A.wgt_factor * A.shipmt_dist_routed)) / sum(A.wgt_factor) as AvgerageMilesPerShip \n\nfrom CensusEcon as A, censusecon_sctg as E\nwhere A.sctg = E.sctg\ngroup by E.description \norder by TotalValue","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql"},"colWidth":6,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"results":{"0":{"graph":{"mode":"pieChart","height":918,"optionOpen":false,"setting":{"pieChart":{}},"commonSetting":{},"keys":[{"name":"SCTGDesc","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"TotalValue","index":2,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712781_-908848099","id":"20180418-140408_72895336","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9074"},{"title":"Table B2 - Shipments by Classification of Goods by Tonnage","text":"%sql\n\nselect E.description as SCTGDesc, count(A.shipmt_id) as count, sum(A.shipmt_value*A.wgt_factor) as TotalValue, sum( A.wgt_factor*(A.shipmt_wght/2000)) as TotalTonnage, (sum( A.wgt_factor * A.shipmt_dist_routed)) / sum(A.wgt_factor) as AvgerageMilesPerShip \n\nfrom CensusEcon as A, censusecon_sctg as E\nwhere A.sctg = E.sctg\ngroup by E.description \norder by totaltonnage","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql"},"colWidth":12,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"results":{"0":{"graph":{"mode":"pieChart","height":300,"optionOpen":false,"setting":{"pieChart":{}},"commonSetting":{},"keys":[{"name":"SCTGDesc","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"TotalTonnage","index":3,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712781_-908848099","id":"20180418-140441_1343979577","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9075"},{"title":"Table B2- Shipments by Classification of Goods by Average Miles Per Shipment","text":"%sql\n\nselect E.description as SCTGDesc, count(A.shipmt_id) as count, sum(A.shipmt_value*A.wgt_factor) as TotalValue, sum( A.wgt_factor*(A.shipmt_wght/2000)) as TotalTonnage, (sum( A.wgt_factor * A.shipmt_dist_routed)) / sum(A.wgt_factor) as AvgerageMilesPerShip \n\nfrom CensusEcon as A, censusecon_sctg as E\nwhere A.sctg = E.sctg\ngroup by E.description \norder by E.description","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql"},"colWidth":12,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"setting":{"pieChart":{},"multiBarChart":{}},"commonSetting":{},"keys":[{"name":"SCTGDesc","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"AvgerageMilesPerShip","index":4,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712783_-908078601","id":"20180418-140613_1591500208","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9076"},{"title":"Table B3","text":"%sql\n\nselect orig_state, count(shipmt_id) as count, format_number(sum(shipmt_value*wgt_factor),0) as TotalValue, format_number(sum( wgt_factor*(shipmt_wght/2000)),0) as TotalTonnage, format_number((sum( wgt_factor * shipmt_dist_routed)) / sum(wgt_factor),0) as AvgerageMilesPerShip \n\nfrom CensusEcon\n\ngroup by orig_state\norder by orig_state","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql"},"colWidth":12,"editorMode":"ace/mode/sql","title":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712783_-908078601","id":"20180418-090334_1766660086","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9077"},{"title":"Table B3 - Shipment Count by State of Origin","text":"%sql\n\nselect B.state, A.orig_state, count(A.shipmt_id) as count, sum(A.shipmt_value*A.wgt_factor) as TotalValue, sum(A.wgt_factor*(A.shipmt_wght/2000)) as TotalTonnage, (sum(A.wgt_factor * A.shipmt_dist_routed)) / sum(A.wgt_factor) as AvgerageMilesPerShip \n\nfrom censusecon as A, censusecon_statecodes as B\nwhere A.orig_state = B.code\ngroup by orig_state, B.state \norder by count(A.shipmt_id)","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql"},"colWidth":6,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"results":{"0":{"graph":{"mode":"pieChart","height":474,"optionOpen":false,"setting":{"pieChart":{}},"commonSetting":{},"keys":[{"name":"state","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"count","index":2,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712784_-897690381","id":"20180419-055739_1611850594","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9078"},{"title":"Table B3 - Shipment Value by State of Origin","text":"%sql\n\nselect B.state, A.orig_state, count(A.shipmt_id) as count, sum(A.shipmt_value*A.wgt_factor) as TotalValue, sum( A.wgt_factor*(A.shipmt_wght/2000)) as TotalTonnage, (sum(A.wgt_factor * A.shipmt_dist_routed)) / sum(A.wgt_factor) as AvgerageMilesPerShip \n\nfrom censusecon as A, censusecon_statecodes as B\nwhere A.orig_state = B.code\ngroup by orig_state, B.state \norder by TotalValue","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql"},"colWidth":6,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"results":{"0":{"graph":{"mode":"pieChart","height":474,"optionOpen":false,"setting":{"pieChart":{}},"commonSetting":{},"keys":[{"name":"state","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"TotalValue","index":3,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712785_-898075129","id":"20180419-060257_1679486039","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9079"},{"title":"Shipment Count By State of Destination","text":"%sql\n\nselect B.state, A.dest_state, count(A.shipmt_id) as count, sum(A.shipmt_value*A.wgt_factor) as TotalValue, sum(A.wgt_factor*(A.shipmt_wght/2000)) as TotalTonnage, (sum(A.wgt_factor * A.shipmt_dist_routed)) / sum(A.wgt_factor) as AvgerageMilesPerShip \n\nfrom censusecon as A, censusecon_statecodes as B\nwhere A.dest_state = B.code\ngroup by dest_state, B.state \norder by count(A.shipmt_id)","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql"},"colWidth":6,"editorMode":"ace/mode/sql","title":true,"results":{"0":{"graph":{"mode":"pieChart","height":584,"optionOpen":false,"setting":{"pieChart":{}},"commonSetting":{},"keys":[{"name":"state","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"count","index":2,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712786_-896920883","id":"20180420-094728_826482776","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9080"},{"title":"Table B3 - Shipment Value by State of Destination","text":"%sql\n\nselect B.state, A.dest_state, count(A.shipmt_id) as count, sum(A.shipmt_value*A.wgt_factor) as TotalValue, sum( A.wgt_factor*(A.shipmt_wght/2000)) as TotalTonnage, (sum(A.wgt_factor * A.shipmt_dist_routed)) / sum(A.wgt_factor) as AvgerageMilesPerShip \n\nfrom censusecon as A, censusecon_statecodes as B\nwhere A.dest_state = B.code\ngroup by dest_state, B.state \norder by TotalValue\n","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql","editOnDblClick":false},"colWidth":6,"editorMode":"ace/mode/sql","title":true,"results":{"0":{"graph":{"mode":"pieChart","height":588,"optionOpen":false,"setting":{"pieChart":{}},"commonSetting":{},"keys":[{"name":"state","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"TotalValue","index":3,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712786_-896920883","id":"20180420-094923_619406874","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9081"},{"title":"Table C1 - Variance by Mode","text":"%sql\nselect mode,\nformat_number(exp( 3.844 + 0.039 * log(2.71828, count(shipmt_id) ) - 0.020 * pow( log(2.71828,count(shipmt_id)), 2)), 2) as Value,\nformat_number(exp( 3.761 + 0.076 * log(2.71828, count(shipmt_id) ) - 0.019 * pow( log(2.71828,count(shipmt_id)), 2)), 2) as WGHT,\nformat_number(exp( 4.092 - 0.015 * log(2.71828, count(shipmt_id) ) - 0.012 * pow( log(2.71828,count(shipmt_id)), 2)), 2) as TonMiles,\nformat_number(exp( 5.168 - 0.084 * log(2.71828, count(shipmt_id) ) - 0.376 * log(2.71828, sum(wgt_factor * shipmt_dist_routed) / sum(wgt_factor))), 2)  as AvgMilesShipped \n\nfrom CensusEcon group by mode order by mode\n","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql"},"colWidth":12,"editorMode":"ace/mode/sql","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712787_-897305632","id":"20180418-092437_459854929","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9082"},{"title":"Table C2 - Variance by SCTG","text":"%sql\nselect sctg,\nformat_number(exp( 3.844 + 0.039 * log(2.71828, count(shipmt_id) ) - 0.020 * pow( log(2.71828,count(shipmt_id)), 2)), 2) as Value,\nformat_number(exp( 3.761 + 0.076 * log(2.71828, count(shipmt_id) ) - 0.019 * pow( log(2.71828,count(shipmt_id)), 2)), 2) as WGHT,\nformat_number(exp( 4.092 - 0.015 * log(2.71828, count(shipmt_id) ) - 0.012 * pow( log(2.71828,count(shipmt_id)), 2)), 2) as TonMiles,\nformat_number(exp( 5.168 - 0.084 * log(2.71828, count(shipmt_id) ) - 0.376 * log(2.71828, sum(wgt_factor * shipmt_dist_routed) / sum(wgt_factor))), 2)  as AvgMilesShipped \n\n\nfrom CensusEcon group by sctg order by sctg\n","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql"},"colWidth":12,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712788_-899229376","id":"20180418-115530_1448129630","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9083"},{"title":"Table C3 - Variance by Original State","text":"%sql\nselect orig_state,\nformat_number(exp( 3.844 + 0.039 * log(2.71828, count(shipmt_id) ) - 0.020 * pow( log(2.71828,count(shipmt_id)), 2)), 2) as Value,\nformat_number(exp( 3.761 + 0.076 * log(2.71828, count(shipmt_id) ) - 0.019 * pow( log(2.71828,count(shipmt_id)), 2 )), 2) as WGHT,\nformat_number(exp( 4.092 - 0.015 * log(2.71828, count(shipmt_id) ) - 0.012 * pow( log(2.71828,count(shipmt_id)), 2 )), 2) as TonMiles,\nformat_number(exp( 5.168 - 0.084 * log(2.71828, count(shipmt_id) ) - 0.376 * log(2.71828, sum(wgt_factor * shipmt_dist_routed) / sum(wgt_factor))), 2)  as AvgMilesShipped\n\n\nfrom CensusEcon group by orig_state order by orig_state\n","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql"},"colWidth":12,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712788_-899229376","id":"20180418-115659_777986668","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9084"},{"title":"Shipments by Hazards","text":"%sql\n\nselect hazmat, count(hazmat) \nfrom CensusEcon \ngroup by hazmat\norder by count(hazmat)","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql"},"colWidth":4,"editorMode":"ace/mode/sql","title":true,"results":{"0":{"graph":{"mode":"pieChart","height":300,"optionOpen":false},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712789_-899614125","id":"20180420-095350_460677916","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9085"},{"title":"Hazards / Non-Hazards Shipments by Quarter","text":"%sql\n\nselect quarter, hazmat, count(quarter) \nfrom CensusEcon \ngroup by quarter, hazmat\norder by count(quarter)","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql"},"colWidth":8,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"setting":{"multiBarChart":{"stacked":true}},"commonSetting":{},"keys":[{"name":"quarter","index":0,"aggr":"sum"}],"groups":[{"name":"hazmat","index":1,"aggr":"sum"}],"values":[{"name":"count(quarter)","index":2,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712789_-899614125","id":"20180420-095703_1133727914","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9086"},{"title":"Hazmat Shipments By State of Origin","text":"%sql\n\nselect B.state, hazmat, count(hazmat) \nfrom CensusEcon as A, CensusEcon_Statecodes as B\nwhere A.orig_state = B.code and A.hazmat != 'N'\ngroup by B.state, A.hazmat\norder by count(hazmat)\n","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql"},"colWidth":12,"editorMode":"ace/mode/sql","title":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"setting":{"multiBarChart":{"stacked":true}},"commonSetting":{},"keys":[{"name":"state","index":0,"aggr":"sum"}],"groups":[{"name":"hazmat","index":1,"aggr":"sum"}],"values":[{"name":"count(hazmat)","index":2,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712790_-898459878","id":"20180418-114717_548756880","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9087"},{"title":"Hazmat Shipments by State of Destination ","text":"%sql\n\nselect B.state, hazmat, count(hazmat) \nfrom CensusEcon as A, CensusEcon_Statecodes as B\nwhere A.dest_state = B.code and A.hazmat != 'N'\ngroup by B.state, A.hazmat\norder by count(hazmat)","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql"},"colWidth":12,"editorMode":"ace/mode/sql","title":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"setting":{"multiBarChart":{"stacked":true}},"commonSetting":{},"keys":[{"name":"state","index":0,"aggr":"sum"}],"groups":[{"name":"hazmat","index":1,"aggr":"sum"}],"values":[{"name":"count(hazmat)","index":2,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712791_-898844627","id":"20180420-090611_1827183948","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9088"},{"title":"States of Origin Shipment Counts by International Destinations","text":"%sql\n\nselect B.state, A.export_cntry, count(A.export_cntry) as count\nfrom censusecon as A, censusecon_statecodes as B\nwhere export_yn = 'Y' and A.orig_state = B.code\ngroup by B.state, A.export_cntry\norder by count","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql"},"colWidth":8,"editorMode":"ace/mode/sql","title":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"setting":{"multiBarChart":{"stacked":true}},"commonSetting":{},"keys":[{"name":"state","index":0,"aggr":"sum"}],"groups":[{"name":"export_cntry","index":1,"aggr":"sum"}],"values":[{"name":"count","index":2,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712792_-900768372","id":"20180420-093629_458726403","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9089"},{"title":"Shipment Count by International Destination","text":"%sql\n\nselect A.export_cntry, count(A.export_cntry) as count\nfrom censusecon as A\nwhere export_yn = 'Y'\ngroup by export_cntry\norder by count","dateUpdated":"2018-11-01T13:55:12-0700","config":{"editorSetting":{"language":"sql"},"colWidth":4,"editorMode":"ace/mode/sql","title":true,"results":{"0":{"graph":{"mode":"pieChart","height":300,"optionOpen":false},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712793_-901153121","id":"20180420-100802_539702354","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9090"},{"text":"%sql\n","dateUpdated":"2018-11-01T13:55:12-0700","config":{"colWidth":12,"editorMode":"ace/mode/sql","results":{},"enabled":true,"editorSetting":{"language":"sql"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1541105712793_-901153121","id":"20180420-101235_1478877924","dateCreated":"2018-11-01T13:55:12-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9091"}],"name":"Census - ECON","id":"2DTP9BXM5","angularObjects":{"2CHS8UYQQ:shared_process":[],"2CKX6DGQZ:shared_process":[],"2C8A4SZ9T_livy2:shared_process":[],"2CK8A9MEG:shared_process":[],"2CKX8WPU1:shared_process":[],"2C4U48MY3_spark2:shared_process":[],"2CKAY1A8Y:shared_process":[],"2CKEKWY8Z:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}